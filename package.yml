name       : flatpak
version    : 0.9.7
release    : 13
source     :
    - https://github.com/flatpak/flatpak/releases/download/0.9.7/flatpak-0.9.7.tar.xz : f43a77cd0b99d465bf1939e43b5593339028b5fb431e567f9735aadbaea695c8
license    :
    - LGPL-2.0
    - LGPL-2.1
component  : desktop.util
summary    : Universal application support
description: |
    Linux application sandboxing and distribution framework
builddeps  :
    - pkgconfig(gtk-doc)
    - pkgconfig(libarchive)
    - pkgconfig(libsoup-2.4)
    - pkgconfig(xau)
    - pkgconfig(fuse)
    - pkgconfig(json-glib-1.0)
    - pkgconfig(libseccomp)
    - pkgconfig(libelf)
    - pkgconfig(ostree-1)
    - bubblewrap
    - docbook-xml
    - elfutils-devel
    - gpgme-devel
    - libassuan-devel
    - libcap2-devel
    - xmlto
rundeps    :
    - bubblewrap
    - elfutils
setup      : |
    %configure --disable-static \
                --with-system-bubblewrap=yes \
               --with-privileged-group=sudo \
               --with-profile-dir=/usr/share/defaults/etc/profile.d \
               --with-dbus-config-dir=/usr/share/dbus-1/system.d \
               --enable-gtk-doc \
               --enable-gtk-doc-html
build      : |
    %make
install    : |
    # gtk-doc install = bork
    install -D -d -m 00755 $installdir/usr/share/gtk-doc/html/flatpak
    %make_install -j1

    # Create the factory working tree
    install -D -d -m 00755 $installdir/usr/share/factory/var/lib/flatpak/repo
    install -d -m 00755 $installdir/usr/share/factory/var/lib/flatpak/repo/{extensions,objects}
    install -D -d -m 00755 $installdir/usr/share/factory/var/lib/flatpak/repo/refs/{heads,remotes}
    install -d -m 00755 $installdir/usr/share/factory/var/lib/flatpak/repo/state
    install -d -m 00755 $installdir/usr/share/factory/var/lib/flatpak/repo/tmp/cache
    touch $installdir/usr/share/factory/var/lib/flatpak/.changed

    cat << _EOF_ > $installdir/usr/share/factory/var/lib/flatpak/repo/config
    [core]
    repo_version=1
    mode=bare-user
    _EOF_

    # Now tell tmpfiles to create using factory
    install -D -m 00644 $pkgfiles/flatpak.tmpfiles $installdir/%libdir%/tmpfiles.d/flatpak.conf

    # support keyfile backend in flatpak
    install -m 00644 $pkgfiles/org.freedesktop.Flatpak.keyrules $installdir/usr/share/polkit-1/rules.d/.
